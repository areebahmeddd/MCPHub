FROM python:3.11-slim

WORKDIR /app

LABEL name="python-analytics"
LABEL version="2.1.0"
LABEL description="Python data analytics service"
LABEL author="Data Team"

COPY . .

# Install dependencies
RUN if [ -f requirements.txt ]; then pip install --no-cache-dir -r requirements.txt; fi
RUN if [ -f pyproject.toml ]; then pip install uv && uv pip install --system .; fi
RUN if [ -f Pipfile ]; then pip install pipenv && pipenv install --system --deploy; fi

EXPOSE 8000

HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \
  CMD curl -f http://localhost:8000/health || exit 1

CMD ["python3", "main.py"]

